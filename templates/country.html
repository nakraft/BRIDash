{% extends 'page_layout.html' %}

{% block title %} Country Detailed View {% endblock %}

{% block header %}
    
{{ hdr_txt  }}

<script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
<!-- <script src="../LeafletControlCustom.js"></script> -->
<script>
    function cb(selection){
        console.log(selection);
        $.getJSON({
            url:"/load_graph",
            data: { 'country': {{country_details.country_id}}, 'graph': selection},
            success: function (result) {
                console.log("Data Returned");
                console.log(result);
                Plotly.newPlot('chart',result,{});

            },
            error: function (result) {
                console.log("No graph available.");
                document.getElementById("chart").innerHTML = "";
            }
        });
    }
</script>

{% endblock %}
    
{% block javascript %} 

<script>
    console.log({{timeline[-1]}});
    // establishes generic timeline data 
    var timeline_details = {
        'max' : {{timeline[-1]}},
        'min' : {{timeline[0]}},
        'starting_values' : [{{ timeline[0] }} , {{timeline[-1]}}],
        'labels' : {{timeline}}
    };

</script>

<script src='../static/js/slider.js'></script>
<script> 
{{ script_txt }} 
</script>

{% endblock %}

{% block sidebar %} 


<body>
        
    <h2>{{country_details.country}}</h2>

    <div>
        <SELECT type="text" id="immigration" class="btn btn-sm btn-dark" onchange="cb(this.value)">
            <OPTION value="expend" selected>Financial Expenditures</option>
            <OPTION value="chinese_immigration" >Chinese Immigration</option>
            <OPTION value="us_immigration">US Immigration</option>
        </SELECT>
    </div>

    <div id='chart' class='chart'></div>

    <table id="t01">
        <tr>
            <td>BRI Partner</td>
            <td>{{country_details.bri_partner}}</td>
        </tr>
        <tr>
            <td>Least Developed Country</td>
            <td>{{country_details.ldc}}</td>
        </tr>
        <tr>
            <td>Landlocked</td>
            <td>{{country_details.landlocked_dc}}</td>
        </tr>
    </table>

    <hr> 

    <h2>Country Level Projects</h2>

    <div class='expend_chart'>
    <table id='country_level_projects' >
        {% for name in expend_titles %}
        <tr>
            <td> {{ name }}  </td>
        </tr>
        {% endfor %}
          
    </table>
    </div>

</body>

<script type="text/javascript">    
    
    var graphs = {{ graphJSON | safe }};
    console.log(graphs);
    Plotly.newPlot('chart', graphs, {});

</script>

{% endblock %}

{% block map %}

{{ map_div }}

{% endblock %}